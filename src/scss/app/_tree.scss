
.agora-view{

  ul.agora-view-tree {

    .entry-header{
      min-height: $media-height-tree;
    }

    .entry-title{
      @include font-size(20);
    }

    .entry-summary,
    .entry-body,
    .comment-content{
      //padding-right: .75rem;
      padding-right: 0;
    }

    .comment-body{
      padding-top: .75rem;
      padding-bottom: 1rem;
      .reply{
        top: .65rem;
        right: .25rem;
      }
      .comment-visibility{
        right: 0.25rem;
      }
    }

    .entry-summary{
      padding-left: 0;
      @include font-size(16);
      .entry-meta{
        padding-bottom: .25rem;
        margin-right: .25rem;
      }
      .btn--collapse{
        right: 0;
      }
    }

    .entry-actions{
      margin-right: 2.25rem;
    }

    .entry-media{
      width: 100%;
      height: $media-height-tree;
    }

    > li.tree-item{
      margin-bottom: -1px;
    }
  }

}


ul.tree-list{
    position: relative;
    margin: 0;
    padding: 0;

    li.tree-item{
        position: relative;
        display: block;
        margin: 0;
        padding: 0;
        transition: all 0.2s ease-in-out;
    }
}

.tree-node{
    position: relative;
    margin: 0;
    border-bottom: 1px solid $grey;
    .tree-header {
      transition: background-color 0.2s ease-in-out
    }
    &.expanded{
      .tree-header{
        background-color: $grey-lighter;
      }
      &.ruler--secondary{
        .tree-header{
          background-color: rgba($brand-secondary-alt,.35);
        }
      }
      > .tree-draw{
        .node-toggle{
          background-color: $white;
        }
      }
    }
}


.tree-content{
  padding-left: $base_tree_sm;
  .entry-comments,
  .evaluation-area{
    padding-left: 0;
    padding-right: 0;
  }
}


.node-toggle {
    position:absolute;
    z-index: 1;
    //left: 15px;
    //top: 36px;
    left: $base_node_t_sm;
    top: 16px;
    width:22px;
    height:22px;
    text-align: center;
    background: $extra-light;
    .toggle{
        &:before,
        &:after{
            content: "";
            position: absolute;
        }
        &:after{
            content: "";
            width: 12px;
            height: 2px;
            background: $brand-primary;
            display:block;
            top: 10px;
            left: 5px;
        }
    }

    &:hover,
    &:focus{
        text-decoration: none;
    }

    &.collapsed{
        .toggle{
            &:before{
                width: 2px;
                height: 12px;
                background: $brand-primary;
                display:block;
                top: 5px;
                left: 10px;
            }
        }
    }
}


  
.final-node{
    position:absolute;
    z-index: 1;
    //top:42px;
    top: 24px;
    //left:23px;
    left: $base_node_f_sm;
    display:block;
    width: 7px;
    height: 7px;
    background: $final-node-color;
    border: 2px solid #fff;
    border-radius: 50%;
}
    
.tree-line{
    display:block;
    z-index: 1;
    position:absolute;
    background-color: #fff;
    //left: 23px;
    left: $base_line_v_sm;
    pointer-events: none;
    opacity: 0;
    @include transition(all .3s ease);
}

  
.line-v{
  background-image: url('#{$img-url}line_v.gif');
  background-repeat: repeat-y;
  background-position: 3px -1px;
  width:7px;
  height:auto;
  top:0;
  bottom:-1px;
}

.line-v-ini{
  background-position: 3px 1px;
  //top:46px;
  top: 24px;
  bottom:-1px;
}

.line-v-end{
  background-position: 3px 0;
  top:1px;
  bottom:auto;
  //height: 46px;
  height: 28px;
  &:before{
    content: '';
    position:absolute;
    display:block;
    background-color: #fff;
    width:7px;
    height: 1px;
    top:-1px;
    left:0;
    @include transition(background-color .3s ease);
  }
  &:after{
    content: '';
    position:absolute;
    display:block;
    background-color: #fff;
    width:7px;
    height: 2px;
    bottom:-2px;
    left:0;
    @include transition(background-color .3s ease);
  }
}

.line-v-cut{
  background-position: 3px 1px;
  //top:82px;
  top: 64px;
  bottom:-1px;
  &:before{
    content: '';
    position:absolute;
    display:block;
    background-color: #fff;
    width:7px;
    height:33px;
    top:-37px;
    left:0;
    @include transition(background-color .3s ease);
  }
}

.line-h{
  display:none;
  background-image: url('#{$img-url}line_h.gif');
  background-repeat: repeat-x;
  background-position: 0 3px;
  height:7px;
  width: $tree_inc_sm;
  //left:28px;
  //top:42px;
  top: 24px;
  left: $base_line_h_sm;
}


.line-h-cut{
  display:block;
  //top:78px;
  top: 60px;
  //left:15px;
  left: $base_line_c_sm;
  width: 24px;
  border-left: 3px solid $white;
  border-right: 3px solid $white;
}



// level 1

ul.agora-view-tree > li.open-node .l1{
  opacity: 1;
}

// level 2

ul.agora-view-tree > li.open-node > ul > li.open-node .l2{
  opacity: 1;
}

// level 3

ul.agora-view-tree > li.open-node > ul > li.open-node > ul > li.open-node .l3{
  opacity: 1;
}

// level 4

ul.agora-view-tree > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node .l4{
  opacity: 1;
}

// level 5

ul.agora-view-tree  > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node .l5{
  opacity: 1;
}

// level 6

ul.agora-view-tree > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node .l6{
  opacity: 1;
}


// level 7

ul.agora-view-tree > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node .l7{
  opacity: 1;
  &.line-v-cut,
  &.line-h-cut{
    opacity: 0;
  }
}

// level 8

ul.agora-view-tree > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node .l8{
  opacity: 1;
   &.line-v-cut,
  &.line-h-cut{
    opacity: 0;
  }
}


// level 9

ul.agora-view-tree > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node .l9{
  opacity: 1;
   &.line-v-cut,
  &.line-h-cut{
    opacity: 0;
  }
}


// level 10

ul.agora-view-tree > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node > ul > li.open-node .l10{
  opacity: 1;
}


/* Generic lines adjustments */

li.open-node .line-v-ini{
  opacity: 1 !important;
}

li.closed-node .line-v-ini{
  opacity: 0 !important;
}

/*li.closed-node > .msg > .line-v-cut,
li.closed-node > .msg > .line-h-cut{
  opacity: 0 !important;
}

li:last-child.end-node{
  .msg > .line-v-cut,
  .msg > .line-h-cut{
    opacity: 1 !important;
  }
}*/


li.open-node > .tree-node > .line-v-cut,
li.open-node > .tree-node > .line-h-cut{
    opacity: 0 !important;
}

li.closed-node > .tree-node > .line-v-cut,
li.closed-node > .tree-node > .line-h-cut{
    opacity: 1 !important;
}

li:last-child.end-node{
  .tree-node > .line-v-cut,
  .tree-node > .line-h-cut{
    opacity: 1 !important;
  }
}

/* Four levels anidation for small screens */



  .line-v{
    &.l2{
      left: $base_line_v_sm + ($tree_inc_sm);
    }
    &.l3{
      left: $base_line_v_sm + ($tree_inc_sm * 2);
    }
    &.l4, &.l5, &.l6, &.l7, &.l8, &.l9, &.l10{
      left: $base_line_v_sm + ($tree_inc_sm * 3);
    }
  }

  .line-h{
    display:block;
    &.l2{
      left: $base_line_h_sm + ($tree_inc_sm);
    }
    &.l3{
      left: $base_line_h_sm + ($tree_inc_sm * 2);
    }
    &.l4, &.l5, &.l6, &.l7, &.l8, &.l9, &.l10{
      display:none;
      left: $base_line_h_sm + ($tree_inc_sm * 3);
    }
  }

  .line-v-cut{
    display:none;
     &.l4, &.l5, &.l6, &.l7, &.l8, &.l9, &.l10{
      display:block;
    }
  }

  .line-h-cut{
    display:none;
    &.l4, &.l5, &.l6, &.l7, &.l8, &.l9, &.l10{
      display:block;
      left: $base_line_c_sm + ($tree_inc_sm * 3);
    }
  }

  // level 1

  ul.agora-view-tree > li ul > li.tree-item{
      .tree-content{
        padding-left: $base_tree_sm + $tree_inc_sm;
      }
      .final-node{
        left: $base_node_f_sm + $tree_inc_sm;
      }
      .node-toggle{
        left: $base_node_t_sm + $tree_inc_sm;
      }
  }

  // level 3

  ul.agora-view-tree > li > ul > li ul > li.tree-item{
      .tree-content{
        padding-left: $base_tree_sm + ($tree_inc_sm * 2);
      }
      .final-node{
        left: $base_node_f_sm + ($tree_inc_sm * 2);
      }
      .node-toggle{
        left: $base_node_t_sm + ($tree_inc_sm * 2);
      }
  }

  // level 4

  ul.agora-view-tree > li > ul > li > ul > li ul li.tree-item{
      .tree-content{
        padding-left: $base_tree_sm + ($tree_inc_sm * 3);
      }
      .final-node{
        left: $base_node_f_sm + ($tree_inc_sm * 3) + 2;
      }
      .node-toggle{
        left: $base_node_t_sm + ($tree_inc_sm * 3);
      }
  }

  li.deepest-xs{
    .tree-node > .line-v-cut,
    .tree-node > .line-h-cut{
        opacity: 0 !important;
    }
  }


/* End four level anidation for small screens */

@include media-up(sm){

  .agora-view{
    ul.agora-view-tree {
        .entry-summary{
          padding-left: 0;
          .entry-meta{
            margin-right: .25rem;
          }
        }
        .entry-media{
          width: $media-width-tree;
          height: $media-height-tree;
          margin-left: 0;
        }
        .entry-media + .entry-summary{
          padding-left: 1.25rem;
        }
    }
  }


  .tree-content{
    padding-left: $base_tree;
  }

  .node-toggle {
    left: $base_node_t;
  }
    
  .final-node{
    left: $base_node_f;
  }
  

  .line-v{
    &.l1{
      left: $base_line_v;
    }
    &.l2{
      left: $base_line_v + ($tree_inc);
    }
    &.l3{
      left: $base_line_v + ($tree_inc * 2);
    }
    &.l4{
      left: $base_line_v + ($tree_inc * 3);
    }
    &.l5{
      left: $base_line_v + ($tree_inc * 4);
    }
    &.l6{
      left: $base_line_v + ($tree_inc * 5);
    }
    &.l7, &.l8, &.l9, &.l10{
      left: $base_line_v + ($tree_inc * 6);
    }
  }

  .line-h:not(.line-h-cut){
    width: $tree_inc;
  }

  .line-h{
    display:block;
    
    &.l1{
      left: $base_line_h;
    }
    &.l2{
      left: $base_line_h + ($tree_inc);
    }
    &.l3{
      left: $base_line_h + ($tree_inc * 2);
    }
    &.l4{
      display:block;
      left: $base_line_h + ($tree_inc * 3);
    }
    &.l5{
      display:block;
      left: $base_line_h + ($tree_inc * 4);
    }
    &.l6{
      display:block;
      left: $base_line_h + ($tree_inc * 5);
    }
    &.l7, &.l8, &.l9, &.l10{
      display:none;
      left: $base_line_h + ($tree_inc * 6);
    }
  }

  .line-v-cut{
    display:none;
    &.l4, &.l5, &.l6{
      display:none;
    }
    &.l7, &.l8, &.l9, &.l10{
      display:block;
    }
  }

  .line-h-cut{
    display:none;
    &.l4, &.l5, &.l6{
      display:none;
    }
    &.l7, &.l8, &.l9, &.l10{
      display:block;
      left: $base_line_c + ($tree_inc * 6);
    }
  }

  /*.line-v{
    &.l2{
      left: $base_line_v + ($tree_inc);
    }
    &.l3{
      left: $base_line_v + ($tree_inc * 2);
    }
    &.l4{
      left: $base_line_v + ($tree_inc * 3);
    }
    &.l5{
      left: $base_line_v + ($tree_inc * 4);
    }
    &.l6{
      left: $base_line_v + ($tree_inc * 5);
    }
    &.l7, &.l8, &.l9, &.l10{
      left: $base_line_v + ($tree_inc * 6);
    }
  }

  .line-h{
    display:block;
    &.l2{
      left: $base_line_h + ($tree_inc);
    }
    &.l3{
      left: $base_line_h + ($tree_inc * 2);
    }
    &.l4{
      left: $base_line_h + ($tree_inc * 3);
    }
    &.l5{
      left: $base_line_h + ($tree_inc * 4);
    }
    &.l6{
      left: $base_line_h + ($tree_inc * 5);
    }
    &.l7, &.l8, &.l9, &.l10{
      display:none;
      left: $base_line_h + ($tree_inc * 6);
    }
  }

  .line-v-cut{
    display:none;
    &.l7, &.l8, &.l9, &.l10{
      display:block;
    }
  }

  .line-h-cut{
    display:none;
    &.l7, &.l8, &.l9, &.l10{
      display:block;
      left: $base_line_c + ($tree_inc * 6);
    }
  }*/


  // level 1

  ul.agora-view-tree > li ul > li.tree-item{
      .tree-content{
        padding-left: $base_tree + $tree_inc;
      }
      .final-node{
        left: $base_node_f + $tree_inc;
      }
      .node-toggle{
        left: $base_node_t + $tree_inc;
      }
  }


  // level 3

  ul.agora-view-tree > li > ul > li ul > li.tree-item{
      .tree-content{
        padding-left: $base_tree + ($tree_inc * 2);
      }
      .final-node{
        left: $base_node_f + ($tree_inc * 2);
      }
      .node-toggle{
        left: $base_node_t + ($tree_inc * 2);
      }
  }

  // level 4

  ul.agora-view-tree > li > ul > li > ul > li ul li.tree-item{
      .tree-content{
        padding-left: $base_tree + ($tree_inc * 3);
      }
      .final-node{
        left: $base_node_f + ($tree_inc * 3);
      }
      .node-toggle{
        left: $base_node_t + ($tree_inc * 3);
      }
  }


  // level 5

  ul.agora-view-tree > li > ul > li > ul > li > ul > li ul li.tree-item{
      .tree-content{
        padding-left: $base_tree + ($tree_inc * 4);
      }
      .final-node{
        left: $base_node_f + ($tree_inc * 4);
      }
      .node-toggle{
        left: $base_node_t + ($tree_inc * 4);
      }
  }


  // level 6

  ul.agora-view-tree > li > ul > li > ul > li > ul > li > ul > li ul li.tree-item{
      .tree-content{
        padding-left: $base_tree + ($tree_inc * 5);
      }
      .final-node{
        left: $base_node_f + ($tree_inc * 5);
      }
      .node-toggle{
        left: $base_node_t + ($tree_inc * 5);
      }
  }


  // level 7

  ul.agora-view-tree > li > ul > li > ul > li > ul > li > ul > li > ul > li ul li.tree-item{
      .tree-content{
        padding-left: $base_tree + ($tree_inc * 6);
      }
      .final-node{
        left: $base_node_f + ($tree_inc * 6);
      }
      .node-toggle{
        left: $base_node_t + ($tree_inc * 6);
      }
  }


  /* Adjust deepest node */

  li.deepest-xs{
    .tree-node > .line-v-cut,
    .tree-node > .line-h-cut{
        opacity: 1 !important;
    }
  }

  li.deepest-sm{
    .tree-node > .line-v-cut,
    .tree-node > .line-h-cut{
        opacity: 0 !important;
    }
  }


}


@include media-up(lg){


  .line-v{
    &.l8{
      left: $base_line_v + ($tree_inc * 7);
    }
    &.l9{
      left: $base_line_v + ($tree_inc * 8);
    }
    &.l10{
      left: $base_line_v + ($tree_inc * 9);
    }
  }

  .line-h{
    &.l7, &.l8, &.l9, &.l10{
      display:block;
    }
    &.l8{
      left: $base_line_h + ($tree_inc * 7);
    }
    &.l9{
      left: $base_line_h + ($tree_inc * 8);
    }
    &.l10{
      left: $base_line_h + ($tree_inc * 9);
    }
  }

  .line-v-cut{
    display:none;
    &.l7, &.l8, &.l9{
      display:none;
    }
    &.l10{
      display:block;
    }
  }

  .line-h-cut{
    display:none;
    &.l7, &.l8, &.l9{
      display:none;
    }

    &.l8{
      left: $base_line_c + ($tree_inc * 7);
    }

    &.l9{
      left: $base_line_c + ($tree_inc * 8);
    }

    &.l10{
      display:block;
      left: $base_line_c + ($tree_inc * 9);
    }
  }

  // level 8

  ul.agora-view-tree > li > ul > li > ul > li > ul > li > ul > li > ul > li > ul > li ul li.tree-item{
      .tree-content{
        padding-left: $base_tree + ($tree_inc * 7);
      }
      .final-node{
        left: $base_node_f + ($tree_inc * 7);
      }
      .node-toggle{
        left: $base_node_t + ($tree_inc * 7);
      }
  }

  // level 9

  ul.agora-view-tree > li > ul > li > ul > li > ul > li > ul > li > ul > li > ul > li > ul > li ul li.tree-item{
      .tree-content{
        padding-left: $base_tree + ($tree_inc * 8);
      }
      .final-node{
        left: $base_node_f + ($tree_inc * 8);
      }
      .node-toggle{
        left: $base_node_t + ($tree_inc * 8);
      }
  }

  // level 10

  ul.agora-view-tree > li > ul > li > ul > li > ul > li > ul > li > ul > li > ul > li > ul > li > ul > li ul li.tree-item{
      .tree-content{
        padding-left: $base_tree + ($tree_inc * 9);
      }
      .final-node{
        left: $base_node_f + ($tree_inc * 9);
      }
      .node-toggle{
        left: $base_node_t + ($tree_inc * 9);
      }
  }


  // Adjust deepest node

  li.deepest-xs,
  li.deepest-sm{
    .tree-node > .line-v-cut,
    .tree-node > .line-h-cut{
        opacity: 1 !important;
    }
  }

  li.deepest-lg{
    .tree-node > .line-v-cut,
    .tree-node > .line-h-cut{
        opacity: 0 !important;
    }
  }

}


@include media-down(xs){
  .agora-view{
    ul.agora-view-tree .entry-actions{
      margin-right: 0;
    }
  }
}
